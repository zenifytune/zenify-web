import{n as e,r as t,t as n}from"./index-BUISP7jP.js";import{n as r,t as i}from"./dist-B7fTPFV_.js";var a=t(e(),1),o=class extends i(r){static shadowRootOptions={...r.shadowRootOptions};static getTemplateHTML=e=>{let{src:t,...n}=e;return r.getTemplateHTML(n)};#e;attributeChangedCallback(e,t,n){e!==`src`&&super.attributeChangedCallback(e,t,n),e===`src`&&t!=n&&this.load()}async _initThumbnails(e){let t=async(t,n)=>{let r=[],i=e.timescale||1,a=e.startNumber||1,o=e.presentationTimeOffset?e.presentationTimeOffset/i:0,s=e.segmentDuration;for(let e=0;e<t;e++){let i=c({thIndex:e,thduration:n,ttiles:t,tduration:s,startNumber:a,pto:o}),l=i+n,u=new Promise((e,t)=>{this.api.provideThumbnail(i,({url:n,width:r,height:a,x:o,y:s})=>{try{e(new VTTCue(i,l,`${n}#xywh=${o},${s},${r},${a}`))}catch(e){t(e)}})});r.push(u)}return await Promise.all(r).catch(e=>console.error(`Error processing thumbnails`,e))},{totalThumbnails:n,thumbnailDuration:r}=s(e),i=await t(n,r),a=this.nativeEl.querySelector(`track[label="thumbnails"]`);a||(a=l(),this.nativeEl.appendChild(a),a.src=u(i),a.dispatchEvent(new Event(`change`)))}async load(){if(this.#e){this.api.attachSource(this.src);return}this.#e=!0;let e=await n(()=>import(`./dash.all.min-BiYh2tpN.js`),[]);this.api=e.MediaPlayer().create(),this.api.initialize(this.nativeEl,this.src,this.autoplay),this.api.on(e.MediaPlayer.events.STREAM_INITIALIZED,()=>{let e=this.api.getRepresentationsByType(`video`),t=this.videoTracks.getTrackById(`main`);t||(t=this.addVideoTrack(`main`),t.id=`main`,t.selected=!0),e.forEach(e=>{let n=e.bandwidth??e.bitrate??(Number.isFinite(e.bitrateInKbit)?e.bitrateInKbit*1e3:void 0),r=t.addRendition(e.id,e.width,e.height,e.mimeType??e.codec,n);r.id=e.id}),this.videoRenditions.addEventListener(`change`,()=>{let e=this.videoRenditions[this.videoRenditions.selectedIndex];e?.id?(this.api.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),this.api.setRepresentationForTypeById(`video`,e.id,!0)):this.api.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}})}),this.api.isDynamic()||this.api.getRepresentationsByType(`image`).forEach(async(e,t)=>{t>0||this._initThumbnails(e)})})}};function s(e){let[t,n]=e.essentialProperties[0].value.split(`x`).map(Number),r=t*n,i=e.adaptation?.period?.duration||null,a=e.segmentDuration,o=a/(e.timescale||1)/r;return{totalThumbnails:i==null?Math.ceil(a/o):Math.ceil(i/o),thumbnailDuration:o}}function c({thIndex:e,tduration:t,thduration:n,ttiles:r,startNumber:i,pto:a}){let o=Math.floor(e/r)+i,s=e%r+1;return(o-1)*t-a+(s-1)*n}function l(){let e=document.createElement(`track`);return e.kind=`metadata`,e.label=`thumbnails`,e.srclang=`en`,e.mode=`hidden`,e.default=!0,e}function u(e){let t=`WEBVTT

`;for(let n of e)t+=`${r(n.startTime)} --> ${r(n.endTime)}
`,t+=`${n.text}

`;let n=new Blob([t],{type:`text/vtt`});return URL.createObjectURL(n);function r(e){return`${String(Math.floor(e/3600)).padStart(2,`0`)}:${String(Math.floor(e%3600/60)).padStart(2,`0`)}:${(e%60).toFixed(3).padStart(6,`0`)}`}}globalThis.customElements&&!globalThis.customElements.get(`dash-video`)&&globalThis.customElements.define(`dash-video`,o);var d=o,f=new Set([`style`,`children`,`ref`,`key`,`suppressContentEditableWarning`,`suppressHydrationWarning`,`dangerouslySetInnerHTML`]),p={className:`class`,htmlFor:`for`};function m(e){return e.toLowerCase()}function h(e){if(typeof e==`boolean`)return e?``:void 0;if(typeof e!=`function`&&!(typeof e==`object`&&e))return e}function g({react:e,tagName:t,elementClass:n,events:r,displayName:i,defaultProps:a,toAttributeName:o=m,toAttributeValue:s=h}){let c=Number.parseInt(e.version)>=19,l=e.forwardRef((i,l)=>{let u=e.useRef(null),d=e.useRef(new Map),m={},g={},v={},y={};for(let[e,t]of Object.entries(i)){if(f.has(e)){v[e]=t;continue}let r=o(p[e]??e);if(n.prototype&&e in n.prototype&&!(e in(globalThis.HTMLElement?.prototype??{}))&&!n.observedAttributes?.some(e=>e===r)){y[e]=t;continue}if(e.startsWith(`on`)){m[e]=t;continue}let i=s(t);r&&i!=null&&(g[r]=String(i),c||(v[r]=i)),r&&c&&(i===h(t)?v[r]=t:v[r]=i)}if(typeof window<`u`){for(let t in m){let n=m[t],i=t.endsWith(`Capture`),a=(r?.[t]??t.slice(2).toLowerCase()).slice(0,i?-7:void 0);e.useLayoutEffect(()=>{let e=u?.current;if(!(!e||typeof n!=`function`))return e.addEventListener(a,n,i),()=>{e.removeEventListener(a,n,i)}},[u?.current,n])}e.useLayoutEffect(()=>{if(u.current===null)return;let e=new Map;for(let t in y)_(u.current,t,y[t]),d.current.delete(t),e.set(t,y[t]);for(let[e,t]of d.current)_(u.current,e,void 0);d.current=e})}if(typeof window>`u`&&n?.getTemplateHTML&&n?.shadowRootOptions){let{mode:t,delegatesFocus:r}=n.shadowRootOptions;v.children=[e.createElement(`template`,{shadowrootmode:t,shadowrootdelegatesfocus:r,dangerouslySetInnerHTML:{__html:n.getTemplateHTML(g,i)},key:`ce-la-react-ssr-template-shadow-root`}),v.children]}return e.createElement(t,{...a,...v,ref:e.useCallback(e=>{u.current=e,typeof l==`function`?l(e):l!==null&&(l.current=e)},[l])},v.children)});return l.displayName=i??n.name,l}function _(e,t,n){e[t]=n,n==null&&t in(globalThis.HTMLElement?.prototype??{})&&e.removeAttribute(t)}var v=g({react:a.default,tagName:`dash-video`,elementClass:d,toAttributeName(e){return e===`muted`?``:e===`defaultMuted`?`muted`:m(e)}});export{v as default};