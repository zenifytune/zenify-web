import{t as e}from"./hls-BVMv227g.js";import{n as t,r as n}from"./index-CRzegdKP.js";import{n as r,t as i}from"./dist-B7fTPFV_.js";var a=n(t(),1),o=(t=>class extends t{static shadowRootOptions={...t.shadowRootOptions};static getTemplateHTML=(e,n={})=>{let{src:r,...i}=e;return`
        <script type="application/json" id="config">
          ${JSON.stringify(n.config||{})}
        <\/script>
        ${t.getTemplateHTML(i)}
      `};#e=null;#t=null;constructor(){super(),this.#i(`config`)}get config(){return this.#t}set config(e){this.#t=e}attributeChangedCallback(e,t,n){e!==`src`&&super.attributeChangedCallback(e,t,n),e===`src`&&t!=n&&this.load()}#n(){var e,t;(e=this.#e)==null||e.remove(),(t=this.nativeEl)==null||t.removeEventListener(`webkitcurrentplaybacktargetiswirelesschanged`,this.#r),this.api&&=(this.api.detachMedia(),this.api.destroy(),null)}async load(){var t;let n=!this.api;if(this.#n(),this.src){if(n&&!this.#t&&(this.#t=JSON.parse(this.shadowRoot.getElementById(`config`)?.textContent||`{}`)),e.isSupported()){switch(await Promise.resolve(),this.api=new e({liveDurationInfinity:!0,autoStartLoad:!1,...this.config}),this.api.loadSource(this.src),this.api.attachMedia(this.nativeEl),this.nativeEl.preload){case`none`:{let t=()=>this.api.startLoad();this.nativeEl.addEventListener(`play`,t,{once:!0}),this.api.on(e.Events.DESTROYING,()=>{this.nativeEl.removeEventListener(`play`,t)});break}case`metadata`:{let t=this.api.config.maxBufferLength,n=this.api.config.maxBufferSize;this.api.config.maxBufferLength=1,this.api.config.maxBufferSize=1;let r=()=>{this.api.config.maxBufferLength=t,this.api.config.maxBufferSize=n};this.nativeEl.addEventListener(`play`,r,{once:!0}),this.api.on(e.Events.DESTROYING,()=>{this.nativeEl.removeEventListener(`play`,r)}),this.api.startLoad();break}default:this.api.startLoad()}this.nativeEl.webkitCurrentPlaybackTargetIsWireless&&this.api.stopLoad(),this.nativeEl.addEventListener(`webkitcurrentplaybacktargetiswirelesschanged`,this.#r),this.#e=document.createElement(`source`),this.#e.setAttribute(`type`,`application/x-mpegURL`),this.#e.setAttribute(`src`,this.src),this.nativeEl.disableRemotePlayback=!1,this.nativeEl.append(this.#e);let n=new WeakMap;this.api.on(e.Events.MANIFEST_PARSED,(e,t)=>{this.nativeEl.autoplay&&this.nativeEl.paused&&this.nativeEl.play().catch(e=>{console.warn(`Autoplay failed:`,e)}),i();let r=this.videoTracks.getTrackById(`main`);r||(r=this.addVideoTrack(`main`),r.id=`main`,r.selected=!0);for(let[e,i]of t.levels.entries()){let t=r.addRendition(i.url[0],i.width,i.height,i.videoCodec,i.bitrate);n.set(i,`${e}`),t.id=`${e}`}for(let[e,n]of t.audioTracks.entries()){let t=n.default?`main`:`alternative`,r=this.addAudioTrack(t,n.name,n.lang);r.id=`${e}`,n.default&&(r.enabled=!0)}}),this.audioTracks.addEventListener(`change`,()=>{let e=+[...this.audioTracks].find(e=>e.enabled)?.id,t=this.api.audioTracks.map(e=>e.id);e!=this.api.audioTrack&&t.includes(e)&&(this.api.audioTrack=e)}),this.api.on(e.Events.LEVELS_UPDATED,(e,t)=>{let r=this.videoTracks[this.videoTracks.selectedIndex??0];if(!r)return;let i=t.levels.map(e=>n.get(e));for(let e of this.videoRenditions)e.id&&!i.includes(e.id)&&r.removeRendition(e)});let r=null;this.api.on(e.Events.ERROR,(t,n)=>{n.type===e.ErrorTypes.NETWORK_ERROR&&n.details===e.ErrorDetails.FRAG_LOAD_ERROR&&(r=n.frag.level)}),this.api.on(e.Events.LEVEL_SWITCHED,(e,t)=>{let n=t.level;r!==null&&n<r&&(console.warn(`\u26A0\uFE0F hls.js downgraded quality from level ${r} to ${n} due to fragment load failure.`),this.videoRenditions.selectedIndex=n,r=null)}),(t=this.videoRenditions)==null||t.addEventListener(`change`,e=>{let t=e.target.selectedIndex;t!=this.api.nextLevel&&(this.api.nextLevel=t)});let i=()=>{for(let e of this.videoTracks)this.removeVideoTrack(e);for(let e of this.audioTracks)this.removeAudioTrack(e)};this.api.once(e.Events.DESTROYING,i);return}await Promise.resolve(),this.nativeEl.canPlayType(`application/vnd.apple.mpegurl`)&&(this.nativeEl.src=this.src)}}#r=()=>{var e,t;this.nativeEl?.webkitCurrentPlaybackTargetIsWireless?(e=this.api)==null||e.stopLoad():(t=this.api)==null||t.startLoad()};#i(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}})(i(r));globalThis.customElements&&!globalThis.customElements.get(`hls-video`)&&globalThis.customElements.define(`hls-video`,o);var s=o,c=new Set([`style`,`children`,`ref`,`key`,`suppressContentEditableWarning`,`suppressHydrationWarning`,`dangerouslySetInnerHTML`]),l={className:`class`,htmlFor:`for`};function u(e){return e.toLowerCase()}function d(e){if(typeof e==`boolean`)return e?``:void 0;if(typeof e!=`function`&&!(typeof e==`object`&&e))return e}function f({react:e,tagName:t,elementClass:n,events:r,displayName:i,defaultProps:a,toAttributeName:o=u,toAttributeValue:s=d}){let f=Number.parseInt(e.version)>=19,m=e.forwardRef((i,u)=>{let m=e.useRef(null),h=e.useRef(new Map),g={},_={},v={},y={};for(let[e,t]of Object.entries(i)){if(c.has(e)){v[e]=t;continue}let r=o(l[e]??e);if(n.prototype&&e in n.prototype&&!(e in(globalThis.HTMLElement?.prototype??{}))&&!n.observedAttributes?.some(e=>e===r)){y[e]=t;continue}if(e.startsWith(`on`)){g[e]=t;continue}let i=s(t);r&&i!=null&&(_[r]=String(i),f||(v[r]=i)),r&&f&&(i===d(t)?v[r]=t:v[r]=i)}if(typeof window<`u`){for(let t in g){let n=g[t],i=t.endsWith(`Capture`),a=(r?.[t]??t.slice(2).toLowerCase()).slice(0,i?-7:void 0);e.useLayoutEffect(()=>{let e=m?.current;if(!(!e||typeof n!=`function`))return e.addEventListener(a,n,i),()=>{e.removeEventListener(a,n,i)}},[m?.current,n])}e.useLayoutEffect(()=>{if(m.current===null)return;let e=new Map;for(let t in y)p(m.current,t,y[t]),h.current.delete(t),e.set(t,y[t]);for(let[e,t]of h.current)p(m.current,e,void 0);h.current=e})}if(typeof window>`u`&&n?.getTemplateHTML&&n?.shadowRootOptions){let{mode:t,delegatesFocus:r}=n.shadowRootOptions;v.children=[e.createElement(`template`,{shadowrootmode:t,shadowrootdelegatesfocus:r,dangerouslySetInnerHTML:{__html:n.getTemplateHTML(_,i)},key:`ce-la-react-ssr-template-shadow-root`}),v.children]}return e.createElement(t,{...a,...v,ref:e.useCallback(e=>{m.current=e,typeof u==`function`?u(e):u!==null&&(u.current=e)},[u])},v.children)});return m.displayName=i??n.name,m}function p(e,t,n){e[t]=n,n==null&&t in(globalThis.HTMLElement?.prototype??{})&&e.removeAttribute(t)}var m=f({react:a.default,tagName:`hls-video`,elementClass:s,toAttributeName(e){return e===`muted`?``:e===`defaultMuted`?`muted`:u(e)}});export{m as default};